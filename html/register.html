<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>注册 - Purecpp.cn 现代C++社区</title>
    <meta name="description" content="注册Purecpp社区账号，加入现代C++技术交流平台">

    <!-- 本地资源（与主站一致） -->
    <link rel="stylesheet" href="css/pico.min.css">
    <link rel="stylesheet" href="font-awesome/css/all.min.css">
    <script defer src="script/alpine.js"></script>

    <style>
        :root {
            --primary: #4f46e5;
            --primary-hover: #4338ca;
            --border-color: #e2e8f0;
            --muted-color: #6b7280;
            --bg-page: #ffffff;
            --bg-card: #ffffff;
            --text-main: #333;
            --text-highlight: var(--primary);
            --input-bg: #f9fafb;
            --success-color: #10b981;
            --error-color: #ef4444;
        }

        /* 深色模式（保留系统跟随，移除手动切换） */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-page: #121212;
                --bg-card: #1e1e1e;
                --text-main: #f3f4f6;
                --text-highlight: #818cf8;
                --border-color: #374151;
                --input-bg: #2d2d2d;
                --success-color: #34d399;
                --error-color: #f87171;
            }
        }

        /* 全局样式：紧凑布局 */
        body {
            background-color: var(--bg-page) !important;
            color: var(--text-main) !important;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            margin: 0;
            padding: 0;
        }

        .page-header {
            max-width: 1400px;
            width: 100%;
            padding: 0.8rem 2rem;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            border-bottom: 1px solid var(--border-color);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none !important;
        }

        .logo img {
            width: 32px;
            height: 32px;
            background-color: transparent !important;
        }

        .logo strong {
            font-size: 18px !important;
            color: var(--primary) !important;
        }

        /* 注册容器：减小与导航栏的空白 */
        .register-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 2rem;
            /* 减小垂直padding，从1.5rem改为0.5rem */
        }

        .register-card {
            width: 100%;
            max-width: 800px;
            background: var(--bg-card) !important;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 0.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            margin-top: 0;
            /* 确保没有额外上边距 */
        }

        .register-card h2 {
            text-align: center;
            color: var(--text-highlight) !important;
            margin-bottom: 0rem !important;
            font-size: 1.4rem;
            font-weight: 600;
        }

        /* 表单样式：紧凑化 */
        .form-group {
            margin-bottom: 0rem !important;
        }

        /* 重点：缩小邮箱、密码区域的额外空白（只改这里） */
        .form-group.email-group,
        .form-group.password-group {
            margin-bottom: 0.1rem !important;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.1rem !important;
            font-size: 0.85rem;
            color: var(--text-main) !important;
        }

        html .form-control {
            width: 100% !important;
            padding: 0.25rem 0.6rem !important;
            border: 1px solid var(--border-color) !important;
            border-radius: 6px !important;
            background: var(--input-bg) !important;
            color: var(--text-main) !important;
            font-size: 0.85rem !important;
            box-sizing: border-box !important;
            transition: border-color 0.2s ease !important;
            line-height: 1.2 !important;
            min-height: unset !important;
            max-height: 42px !important;
            height: 42px !important;
            appearance: none !important;
            -webkit-appearance: none !important;
            -moz-appearance: none !important;
        }

        .form-control:focus {
            outline: none !important;
            border-color: var(--primary) !important;
            box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.1) !important;
        }

        /* 行内表单：紧凑间距 */
        .form-row {
            display: flex;
            gap: 0.8rem;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0 !important;
        }

        /* 1. 输入框容器：相对定位，用于放置右侧图标 */
        .verify-input-group {
            position: relative;
            width: 100%;
        }

        /* 2. 验证码输入框：右侧预留图标空间，避免文字被遮挡 */
        .verify-input {
            padding-right: 38px !important;
        }

        /* 保留原有输入框高度（30px），确保整体协调 */
        .form-control.verify-input {
            height: 40px !important;
            padding: 0.25rem 0.6rem !important;
            font-size: 0.8rem !important;
        }

        /* C++ 问题显示样式（紧凑间距，消除多余空白） */
        .cpp-question {
            background-color: #d8d7d7 !important;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 0.5rem;
            margin-bottom: 0.3rem !important;
            font-size: 0.85rem;
            color: var(--text-main);
            margin-top: 0 !important;
            pointer-events: none;
            opacity: 0.9;
            cursor: default;
        }

        @media (prefers-color-scheme: dark) {
            .cpp-question {
                background-color: #2a2a2a !important;
            }
        }

        /* 错误提示样式（隐藏，还原原始无提示效果） */
        .error-message {
            display: none !important;
        }

        .btn-register {
            width: 100%;
            padding: 0.35rem;
            background: var(--primary) !important;
            border: none !important;
            border-radius: 6px !important;
            color: white !important;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer !important;
            transition: background 0.3s ease;
            margin-top: 0.3rem !important;
            opacity: 1 !important;
        }

        /* 强制注册按钮始终可点击，还原原始交互 */
        .btn-register:disabled {
            background: var(--primary) !important;
            cursor: pointer !important;
        }

        /* 协议说明：紧凑 */
        .agreement {
            margin: 0.2rem 0 !important;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .agreement input {
            vertical-align: middle;
            font-size: 0.8rem;
        }

        .agreement a {
            color: var(--text-highlight) !important;
            text-decoration: none !important;
        }

        .agreement a:hover {
            text-decoration: underline !important;
        }

        .login-link {
            text-align: center;
            margin-top: 0rem !important;
            font-size: 0.85rem;
        }

        .login-link a {
            color: var(--text-highlight) !important;
            text-decoration: none !important;
        }

        /* 响应式适配：保持紧凑 */
        @media (max-width: 768px) {
            .register-card {
                padding: 0.6rem;
                max-width: 100%;
            }

            .page-header {
                padding: 0.8rem 1rem;
            }

            .register-container {
                padding: 0.3rem 1rem;
                /* 移动端也减小空白 */
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .verify-code {
                flex-direction: column;
                gap: 0.6rem;
            }

            .verify-code .form-control {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <!-- 统一页头占位符 -->
    <div id="header-container"></div>

    <!-- 注册主体：减小与导航栏的空白 -->
    <div class="register-container">
        <div class="register-card" x-data="registerFormLogic()">
            <h2>账号注册</h2>
            <div x-show="message" x-text="message"
                 :style="{color: messageColor, marginTop: '1rem', textAlign: 'center', fontSize: '0.9rem', padding: '0.75rem', borderRadius: '6px', backgroundColor: messageColor === '#ef4444' ? 'rgba(239, 68, 68, 0.1)' : 'rgba(16, 185, 129, 0.1)', marginBottom: '1rem'}">
            </div>
            <div
                    style="background-color: #f0f9ff; border: 1px solid #bfdbfe; color: #1e40af; padding: 0.75rem; border-radius: 6px; margin-bottom: 1rem; font-size: 0.9rem; text-align: center;">
                <i class="fas fa-info-circle" style="margin-right: 0.5rem;"></i>
                注册成功后需要验证邮箱，请使用常用邮箱地址
            </div>
            <form id="registerForm" @submit="handleSubmit">
                <div class="form-group">
                    <label for="username">用户名</label>
                    <input type="text" id="username" class="form-control" placeholder="请输入3-20位字母、数字或下划线" required
                        x-model="username">
                </div>
                <!-- 邮箱组：添加专属类，缩小间距 -->
                <div class="form-group email-group">
                    <label for="email">邮箱</label>
                    <input type="email" id="email" class="form-control" placeholder="请输入有效邮箱地址" required
                        x-model="email">
                </div>
                <div class="form-row">
                    <!-- 密码组：添加专属类，缩小间距 -->
                    <div class="form-group password-group">
                        <label for="password">密码</label>
                        <input type="password" id="password" class="form-control" placeholder="长度6-20位，且含大小写字母和数字"
                            required x-model="password">
                    </div>
                    <!-- 确认密码组：添加专属类，缩小间距 -->
                    <div class="form-group password-group">
                        <label for="confirmPwd">确认密码</label>
                        <input type="password" id="confirmPwd" class="form-control" placeholder="请再次输入密码" required
                            x-model="confirmPwd">
                    </div>
                </div>

                <!-- 问题区域：保持原样，不修改 -->
                <div class="verify-code">
                    <div class="form-group">
                        <div class="cpp-question"
                            x-html="`问题：<span style='color: red;'>${currentQuestion.question}</span>`">
                        </div>
                        <!-- 输入框容器：包裹输入框 -->
                        <div class="verify-input-group">
                            <input type="text" id="verifyAnswer" class="form-control verify-input" placeholder="请输入"
                                required x-model="verifyAnswer">
                        </div>
                    </div>
                </div>

                <div class="agreement">
                    <input type="checkbox" id="agreement" required x-model="agreement">
                    <label for="agreement">我已阅读并同意 <a href="/terms.html">《用户服务协议》</a> 和 <a
                            href="/privacy.html">《隐私政策》</a></label>
                </div>
                <!-- 注册按钮：保持原样 -->
                <button type="submit" class="btn-register" x-bind:disabled="isSubmitting">
                    <span x-show="!isSubmitting">注册账号</span>
                    <span x-show="isSubmitting"
                        style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                        <i class="fas fa-spinner fa-spin"></i> 正在注册...
                    </span>
                </button>
                <div class="login-link">
                    已有账号？<a href="/login.html">立即登录</a>
                </div>
            </form>
        </div>
    </div>
    <!-- 统一页脚占位符 -->
    <div id="footer-container"></div>

    <!-- API服务脚本 -->
    <script src="script/api_service.js"></script>
    <!-- 统一布局脚本 -->
    <script src="script/layout.js"></script>

    <script>
        function registerFormLogic() {
            return {
                // 表单数据绑定
                username: '',
                email: '',
                password: '',
                confirmPwd: '',
                verifyAnswer: '',
                agreement: false,
                message: '',
                messageColor: '',
                isSubmitting: false,

                // C++ 题库（保留你提供的内容）
                question_index: 0,
                currentQuestion: {},

                // 初始化：随机选择C++问题
                async init() {
                    try {
                        const response = await apiService.getQuestions();
                        const data = response.data;
                        this.currentQuestion = data.data;
                        this.question_index = data.data.index;
                        console.log("question index: " + this.question_index);
                    } catch (error) {
                        console.error('获取问题失败:', error);
                        this.currentQuestion = "请求服务器失败";
                        this.showMessage('获取问题失败，请刷新页面重试', true);
                    }
                },

                // 显示消息函数
                showMessage(message, isError = false) {
                    this.message = message;
                    this.messageColor = isError ? '#ef4444' : '#10b981';
                },

                // 表单提交处理：保持原样
                async handleSubmit(e) {
                    e.preventDefault();
                    if (this.isSubmitting) return;

                    const password = this.password;
                    const confirmPwd = this.confirmPwd;
                    const verifyAnswer = this.verifyAnswer.trim();
                    const question_index = this.question_index;

                    // 保留原始验证逻辑
                    if (password !== confirmPwd) {
                        this.showMessage('两次输入的密码不一致，请重新输入', true);
                        return;
                    }
                    if (verifyAnswer.length < 1) {
                        this.showMessage('请输入答案', true);
                        return;
                    }
                    if (!this.agreement) {
                        this.showMessage('请阅读并同意用户服务协议和隐私政策', true);
                        return;
                    }

                    this.isSubmitting = true;
                    this.message = '';

                    try {
                        // 使用apiService处理注册请求
                        const response = await apiService.register(this.username, this.email, this.password, verifyAnswer, question_index);

                        if (response.success) {
                            // 注册成功
                            this.showMessage('注册成功！验证邮箱后才可以登录，请在24小时内前往邮箱验证账号。' + response.data.email, false);
                            // 延迟跳转，让用户看到成功消息
                            setTimeout(() => {
                                window.location.href = '/login.html';
                            }, 2000);
                        } else {
                            this.showMessage(response.message || '注册失败：请检查输入信息。', true);
                        }
                    } catch (error) {
                        // 网络错误或其他异常
                        console.error('注册请求失败:', error);
                        this.showMessage('注册请求失败，原因：' + (error.message || '网络错误，请稍后重试'), true);
                    } finally {
                        this.isSubmitting = false;
                    }
                }
            };
        }
    </script>
</body>

</html>